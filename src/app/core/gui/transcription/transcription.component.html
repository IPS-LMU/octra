<app-alert #alert></app-alert>
<app-transcription-send-modal #modal></app-transcription-send-modal>
<app-transcription-sending-modal [sendError]="sendError" #transcrSendingModal></app-transcription-sending-modal>
<app-overview-modal #modalOverview id="overview" (transcriptionSend)="onSendNowClick()"></app-overview-modal>
<app-shortcuts-modal #modalShortcuts [generalShortcuts]="generalShortcuts" [editor]="Interface"></app-shortcuts-modal>
<app-transcription-demo-end-modal #modalDemoEnd></app-transcription-demo-end-modal>
<app-transcription-postpone-all-modal #modalPostponeAll></app-transcription-postpone-all-modal>
<app-transcription-guidelines-modal #modalGuidelines
                                    [guidelines]="transcrService.guidelines"></app-transcription-guidelines-modal>
<app-activity-timeout-modal #inactivityModal *ngIf="settingsService.appSettings.octra.inactivityNotice !== undefined
&& settingsService.appSettings.octra.inactivityNotice.showAfter !== undefined"></app-activity-timeout-modal>
<app-missing-permissions-modal #missingPermissionsModal></app-missing-permissions-modal>

<div class="flex">
    <span id='saving'>
        <fa-icon *ngIf="saving === 'saving'" style="color:#333333" icon="save"></fa-icon>
        <fa-icon *ngIf="saving === 'error'" style="color:red" icon="save"></fa-icon>
    </span>
  <app-fastbar
    [responsive]="responsive"
    [buttonLabels]="{
            shortcuts: 'general.shortcuts' | transloco,
            guidelines: 'general.guidelines' | transloco,
            overview: 'general.overview' | transloco,
            help: 'general.help' | transloco
            }"

    (shortcutbtnclicked)="modalShortcuts.open()"
    (guidelinesbtnclicked)="modalGuidelines.open()"
    (overviewbtnclicked)="modalOverview.open()"
  ></app-fastbar>

  <div class="flex">
    <div id="editor-loading" *ngIf="!editorloaded || waitForSend">
      <fa-icon icon="spinner" [spin]="true" [size]="'4x'" style="color:lightgray"></fa-icon>
    </div>
    <ng-template appLoadeditor></ng-template>
  </div>

  <div *ngIf="(settingsService.isTheme('shortAudioFiles') || settingsService.isTheme('secondSegmentFast') || settingsService.isTheme('korbinian'))
    && (appStorage.usemode === 'online' || appStorage.usemode === 'demo') && transcrService.feedback !== null">
    <form class="form-inline" id="bottom-comment">
      <fieldset class="w-100">
        <div class="form-group" style="padding-top:0;">
                <textarea class="form-control w-100" [(ngModel)]="transcrService.comment" #commentArea
                          (ngModelChange)="onCommentChange()"
                          placeholder="{{'general.insert comment'| transloco}}"
                          name="comment"
                          style="height:40px;padding:10px;resize: none;"></textarea>
        </div>
      </fieldset>
    </form>
  </div>

  <div class="row position-relative" id="bottom-navigation" role="group">
    <ng-container
      *ngIf="appStorage.usemode === 'online' || (appStorage.usemode === 'demo' && !settingsService.isTheme('secondSegmentFast')); else defaultBottom">
      <ng-container [ngSwitch]="settingsService?.projectsettings?.octra?.theme">
        <ng-container *ngSwitchCase="'shortAudioFiles'">
          <button class="btn btn-secondary btn-raised col-md-3" (click)="abortTranscription()">
            <fa-icon [icon]="['fas', 'times-circle']"></fa-icon>
            <span>
                   {{"general.quit" | transloco}}
            </span>
          </button>
          <div class="col-md-9 position-relative px-0">
            <div id="need-audio-playback" *ngIf="!audiomanager.hasPlayed" [tooltipHtml]="(!audiomanager.hasPlayed) ? ('transcription.need audio playback' | transloco) : ''"></div>
            <button class="btn btn-raised btn-danger col-md-4" (click)="sendTranscriptionForShortAudioFiles('bad')"
                    [disabled]="!audiomanager.hasPlayed">
              <fa-icon icon="star"></fa-icon>
            </button>
            <button class="btn btn-raised btn-warning col-md-4" style="background-color: orange"
                    [disabled]="!audiomanager.hasPlayed"
                    (click)="sendTranscriptionForShortAudioFiles('middle')">
              <fa-icon icon="star"></fa-icon>
              <fa-icon icon="star"></fa-icon>
            </button>
            <button class="btn btn-raised btn-primary col-md-4" (click)="sendTranscriptionForShortAudioFiles('good')"
                    [disabled]="!audiomanager.hasPlayed">
              <fa-icon icon="star"></fa-icon>
              <fa-icon icon="star"></fa-icon>
              <fa-icon icon="star"></fa-icon>
            </button>
          </div>
        </ng-container>
        <ng-container *ngSwitchCase="'korbinian'">
          <button class="btn btn-secondary btn-raised col-md-4" (click)="abortTranscription()">
            <fa-icon [icon]="['fas', 'times-circle']"></fa-icon>
            <span>
                   {{"general.quit" | transloco}}
            </span>
          </button>
          <button class="btn btn-raised btn-info col-md-2" (click)="sendTranscriptionForKorbinian('NO')">
            NO
          </button>
          <button class="btn btn-raised btn-danger col-md-2" (click)="sendTranscriptionForKorbinian('VE')">
            VE
          </button>
          <button class="btn btn-raised btn-secondary col-md-2" (click)="sendTranscriptionForKorbinian('EE')">
            EE
          </button>
          <button class="btn btn-raised btn-primary col-md-2" (click)="sendTranscriptionForKorbinian('AN')">
            AN
          </button>
        </ng-container>
        <ng-container *ngSwitchCase="'secondSegmentFast'">
          <button class="btn btn-secondary btn-raised col-md-3" (click)="abortTranscription()">
            <fa-icon [icon]="['fas', 'times-circle']"></fa-icon>
            <span>
                   {{"general.quit" | transloco}}
            </span>
          </button>
          <div class="col-md-9">
            <div class="row position-relative">
              <div id="need-audio-playback" *ngIf="!audiomanager.hasPlayed" [tooltipHtml]="(!audiomanager.hasPlayed) ? ('transcription.need audio playback' | transloco) : ''"></div>
              <button class="btn btn-outline-danger bg-white col-md-3" style="color: black;"
                      (click)="sendTranscriptionForShortAudioFiles('postpone_before')"
                      [disabled]="!audiomanager.hasPlayed" *ngIf="projectsettings.plugins.postponeAll?.enabled">
                <fa-icon icon="times-circle" style="color: red;"></fa-icon>
                Aufgaben sperren
              </button>
              <button class="btn btn-raised btn-danger" [ngClass]="{
            'col-md-3': projectsettings.plugins.postponeAll?.enabled,
            'col-md-4': !(projectsettings.plugins.postponeAll?.enabled)
          }" (click)="sendTranscriptionForShortAudioFiles('bad')"
                      [disabled]="!audiomanager.hasPlayed">
                <fa-icon icon="star"></fa-icon>
              </button>
              <button class="btn btn-raised btn-warning" [ngClass]="{
            'col-md-3': projectsettings.plugins.postponeAll?.enabled,
            'col-md-4': !(projectsettings.plugins.postponeAll?.enabled)
          }" style="background-color: orange"
                      [disabled]="!audiomanager.hasPlayed"
                      (click)="sendTranscriptionForShortAudioFiles('middle')">
                <fa-icon icon="star"></fa-icon>
                <fa-icon icon="star"></fa-icon>
              </button>
              <button class="btn btn-raised btn-primary" [ngClass]="{
            'col-md-3': projectsettings.plugins.postponeAll?.enabled,
            'col-md-4': !(projectsettings.plugins.postponeAll?.enabled)
          }" (click)="sendTranscriptionForShortAudioFiles('good')"
                      [disabled]="!audiomanager.hasPlayed">
                <fa-icon icon="star"></fa-icon>
                <fa-icon icon="star"></fa-icon>
                <fa-icon icon="star"></fa-icon>
              </button>
            </div>
          </div>
        </ng-container>
      </ng-container>
    </ng-container>
    <ng-template #defaultBottom>
      <button class="btn btn-secondary btn-raised col-md-6"
              *ngIf="appStorage.usemode !== 'url'"
              (click)="abortTranscription()">
        <fa-icon [icon]="['fas', 'times-circle']"></fa-icon>
        <span *ngIf="!appStorage.easymode" [ngClass]="{' d-none d-md-inline': appc.octra.responsive.enabled}">
                    {{"general.quit" | transloco}}
            </span>
      </button>
      <button type="button" class="btn btn-primary btn-raised col-md-6"
              (click)="navbarServ.doclick('export');" *ngIf="appStorage.usemode === 'local'">
        <fa-icon icon="download"></fa-icon>
        <span
          *ngIf="!appStorage.easymode"
          [ngClass]="{'d-none d-md-inline': appc.octra.responsive.enabled}"> {{"general.export data" | transloco}}</span>
      </button>
      <button type="button" class="btn btn-primary btn-raised col-md-6"
              (click)="onSendButtonClick()"
              *ngIf="appStorage.usemode === 'online' || appStorage.usemode === 'demo'">
            <span
              *ngIf="!appStorage.easymode"
              [ngClass]="{'d-none d-md-inline': appc.octra.responsive.enabled}"> {{"transcription.send" | transloco}} </span>
        <fa-icon icon="paper-plane"></fa-icon>
      </button>
      <button type="button" class="btn btn-primary btn-raised w-100"
              (click)="onSaveTranscriptionButtonClicked()" *ngIf="appStorage.usemode === 'url'">
        <span>{{"transcription.send" | transloco}} </span>
        <fa-icon icon="paper-plane"></fa-icon>
      </button>
    </ng-template>
  </div>
</div>
