<app-alert #alert></app-alert>
<app-transcription-send-modal #modal></app-transcription-send-modal>
<app-transcription-sending-modal [sendError]="send_error" #modal2></app-transcription-sending-modal>
<app-overview-modal #modal_overview id="overview"></app-overview-modal>
<app-shortcuts-modal #modal_shortcuts [editor]="Interface"></app-shortcuts-modal>
<app-transcription-success-modal #success></app-transcription-success-modal>
<app-transcription-guidelines-modal #modal_guidelines
                                    [guidelines]="transcrService.guidelines"></app-transcription-guidelines-modal>

<div class="flex">
    <span id='saving'>
        <fa-icon *ngIf="saving === 'saving'" style="color:#333333" icon="save"></fa-icon>
        <fa-icon *ngIf="saving === 'error'" style="color:red" icon="save"></fa-icon>
    </span>
    <app-fastbar
            [responsive]="responsive"
            [button_labels]="{
            shortcuts: 'general.shortcuts' | translate,
            guidelines: 'general.guidelines' | translate,
            overview: 'general.overview' | translate,
            help: 'general.help' | translate
            }"

            (shortcutbtnclicked)="modal_shortcuts.open()"
            (guidelinesbtnclicked)="modal_guidelines.open()"
            (overviewbtnclicked)="modal_overview.open()"
    ></app-fastbar>

    <div class="flex">
        <ng-template appLoadeditor></ng-template>
    </div>

    <div id="bottom-feedback" class="card" #feedback
         *ngIf="appStorage.usemode === 'online' && transcrService.feedback !== null && transcrService.feedback !== undefined">
        <div class="card-header">
            <table style="width:100%;">
                <tbody>
                <tr>
                    <td><span class="link" (click)="expandFeedback()"
                              style="width:100%;display: block;vertical-align: middle;">FEEDBACK <span
                            class="required_marker" *ngIf="transcrService.feedback.required">*</span></span>
                    </td>
                    <td style="text-align: right">
                        <fa-icon *ngIf="!feedback_expanded" icon="chevron-up" (click)="expandFeedback()"
                                 style="color:grey; display: block; padding:0;cursor:pointer;vertical-align: middle;"></fa-icon>

                        <fa-icon *ngIf="feedback_expanded" icon="chevron-down" (click)="expandFeedback()"
                                 style="color:grey; display: block; padding:0;cursor:pointer;vertical-align: middle;"></fa-icon>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="card-body" [hidden]="!feedback_expanded">
            <div class="inner">
                <form #fo="ngForm">
                    <fieldset>
                        <div class="form-group" *ngFor="let group of transcrService.feedback.groups">
                            <label class="control-label">{{translate(group.title, langService.currentLang)}}</label>
                            <span class="required_marker" *ngIf="group.controls[0].required">*</span>
                            <br/>
                            <br/>
                            <div class="ctrl" *ngFor="let control of group.controls;">
                                <div class="radio" *ngIf="control.type.type === 'radiobutton'">
                                    <label>{{translate(control.label.languages, langService.currentLang)}}
                                        <input type="radio"
                                               name="{{group.name}}" value="{{control.value}}"
                                               [checked]="control.custom.checked"
                                               [required]="control.required"
                                               [(ngModel)]="feedback_data[group.name]"
                                        />
                                    </label>
                                </div>
                                <div class="checkbox" *ngIf="control.type.type === 'checkbox'">
                                    <label>
                                        <input type="checkbox"
                                               name="{{control.value}}" value="true"
                                               [checked]="control.custom.checked" #checkb
                                               [required]="control.required"
                                               (change)="checkBoxChanged(group.name, control.value)">
                                        <span class="required_marker" *ngIf="control.required">*</span>
                                        {{translate(control.label.languages, langService.currentLang)}}
                                    </label>
                                </div>
                                <div *ngIf="control.type.type === 'textarea'">
                                    <label>{{translate(control.label.languages, langService.currentLang)}}</label><br/>
                                    <textarea class="form-control"
                                              name="{{group.name}}" value="{{control.value}}"
                                              [required]="control.required"></textarea>
                                    [(ngModel)]="feedback_data[group.name]"
                                </div>
                            </div>
                        </div>
                        <div class="form-group">
                            <div>
                                <label>{{"transcription-submit.comment description" | translate}}</label><br/>
                                <textarea class="form-control" [(ngModel)]="transcrService.feedback.comment"
                                          name="comment"></textarea>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>
    <div class="row" id="bottom-navigation" role="group">
        <button class="btn btn-secondary btn-raised col-md-6" *ngIf="appStorage.usemode !== 'url'"
                (click)="abortTranscription()">
            <fa-icon [icon]="['far', 'times-circle']"></fa-icon>
            <span *ngIf="!appStorage.easymode" [ngClass]="{' d-none d-md-inline': appc.octra.responsive.enabled}">
                    {{"general.quit" | translate}}
            </span>
        </button>
        <button type="button" class="btn btn-primary btn-raised col-md-6"
                (click)="navbarServ.doclick('export');" *ngIf="appStorage.usemode === 'local'">
            <fa-icon icon="download"></fa-icon>
            <span
                    *ngIf="!appStorage.easymode"
                    [ngClass]="{'d-none d-md-inline': appc.octra.responsive.enabled}"> {{"general.export data" | translate}}</span>
        </button>
        <button type="button" class="btn btn-primary btn-raised col-md-6"
                (click)="onSendButtonClick()" *ngIf="appStorage.usemode === 'online'">
            <span
                    *ngIf="!appStorage.easymode"
                    [ngClass]="{'d-none d-md-inline': appc.octra.responsive.enabled}"> {{"transcription.send" | translate}} </span>
            <fa-icon icon="paper-plane"></fa-icon>
        </button>
        <button type="button" class="btn btn-primary btn-raised w-100"
                (click)="onSaveTranscriptionButtonClicked()" *ngIf="appStorage.usemode === 'url'">
            <span>SAVE TRANSCRIPTION</span>
            <fa-icon icon="paper-plane"></fa-icon>
        </button>
    </div>
</div>