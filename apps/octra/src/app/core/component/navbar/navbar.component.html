<nav
  class="navbar navbar-expand-md navbar-dark bg-primary py-0"
  aria-label="Fourth navbar example"
  #navbar
  id="navbar"
>
  <div class="container-fluid">
    <a
      [title]="
        'last update: ' + (AppInfo.lastUpdate | date : 'dd.MM.yyyy H:mm z')
      "
      class="navbar-brand"
      href="#"
      >OCTRA v{{ version }}
      <ng-container
        *ngIf="
          appStorage.useMode !== undefined && appStorage.useMode !== undefined
        "
      >
        ({{ appStorage.useMode }})
      </ng-container>
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarsExample04"
      (click)="collapse.toggle()"
      aria-controls="navbarsExample04"
      [attr.aria-expanded]="!isCollapsed"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div
      class="collapse navbar-collapse"
      id="navbarsExample04"
      #collapse="ngbCollapse"
      [(ngbCollapse)]="isCollapsed"
    >
      <ul
        *ngIf="!appStorage.loggedIn; else showMembersNav"
        class="navbar-nav me-auto mb-2 mb-md-0"
      >
        <li [routerLinkActive]="['active']" class="nav-item active">
          <a
            [queryParamsHandling]="'merge'"
            [routerLink]="['/login']"
            class="nav-link"
            (click)="isCollapsed = true"
            >{{ 'general.login' | transloco }}</a
          >
        </li>
        <li [routerLinkActive]="['active']" class="nav-item">
          <a
            [queryParamsHandling]="'merge'"
            [routerLink]="['/features']"
            class="nav-link"
            (click)="isCollapsed = true"
            >{{ 'general.features' | transloco }}</a
          >
        </li>
        <li [routerLinkActive]="['active']" class="nav-item">
          <a
            [queryParamsHandling]="'merge'"
            [routerLink]="['/news']"
            class="nav-link"
            (click)="isCollapsed = true"
            >{{ 'general.news' | transloco }}</a
          >
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="https://www.phonetik.uni-muenchen.de/apps/octra/manual/1.4.0/"
            target="_blank"
          >
            {{ 'general.manual' | transloco }}
          </a>
        </li>
        <li class="nav-item">
          <a
            class="nav-link"
            href="https://github.com/IPS-LMU/octra"
            target="_blank"
          >
            <i class="bi bi-github"></i>
            Github
          </a>
        </li>
      </ul>

      <ng-template #showMembersNav>
        <ul class="navbar-nav me-auto">
          <ng-template [ngForOf]="editors" let-editor ngFor>
            <li
              class="nav-item"
              *ngIf="
                appStorage.loggedIn &&
                navbarServ.showInterfaces &&
                interfaceActive(editor.name)
              "
              (click)="setInterface(editor.name)"
            >
              <a
                class="nav-link"
                [ngClass]="{
                  active: appStorage.interface === editor.name
                }"
                (click)="isCollapsed = true"
              >
                <span>
                  <i [classList]="['bi', editor.icon]"></i>
                  <span class="d-none d-xl-inline">
                    {{ editor.translate | transloco }}
                  </span>
                </span>
              </a>
            </li>
          </ng-template>
          <li
            *ngIf="
              appStorage.loggedIn &&
              navbarServ.showInterfaces &&
              settService.appSettings.octra.showdetails
            "
            class="nav-item"
          >
            <a (mouseup)="openStatisticsModal()" class="nav-link">
              <i class="bi bi-pie-chart-fill"></i>
              <span class="d-none d-xl-inline"> Statistics</span></a
            >
          </li>
        </ul>
      </ng-template>

      <!--
        tiersDropdown
        -->
      <ul class="navbar-nav">
        <li
          class="nav-item dropdown"
          *ngIf="transcrServ !== undefined"
          [ngStyle]="{
            display:
              !appStorage.loggedIn ||
              appStorage.onlineSession?.currentProject === undefined ||
              !appStorage.audioLoaded
                ? 'none'
                : 'inherit'
          }"
          ngbDropdown
          [container]="'body'"
          display="dynamic"
          placement="bottom-end"
        >
          <a ngbDropdownToggle type="button" class="nav-link dropdown-toggle">
            {{
              transcrServ.currentlevel!.name.length > 30
                ? transcrServ.currentlevel!.name.substring(0, 30) + '...'
                : transcrServ.currentlevel!.name
            }}
            <i class="bi bi-book-half navbar-icon"></i>
          </a>
          <div
            ngbDropdownMenu
            class="dropdown-menu dropdown dropdown-primary dropdown-menu-right"
            role="menu"
            style="min-width: 300px"
            (click)="$event.stopPropagation()"
          >
            <table style="width: 100%">
              <tbody>
                <tr
                  *ngFor="
                    let level of transcrServ.annotation.levels;
                    let i = index
                  "
                  [ngClass]="{
                    selected: transcrServ.selectedlevel === i
                  }"
                  class="level-row"
                >
                  <td
                    (click)="selectLevel(i)"
                    [ngClass]="{
                      disabled: level.getTypeString() !== 'SEGMENT'
                    }"
                    style="cursor: pointer"
                  >
                    {{ i + 1 }}:
                  </td>
                  <td
                    [ngClass]="{
                      disabled: level.getTypeString() !== 'SEGMENT'
                    }"
                  >
                    <input
                      (blur)="onLevelNameLeave($event, i)"
                      (click)="onLevelNameClick()"
                      maxlength="100"
                      type="text"
                      value="{{ level.name }}"
                      style="width: 100%"
                    />
                  </td>
                  <td>
                    <i
                      class="bi bi-trash"
                      (click)="onLevelRemoveClick(i, level.id)"
                      style="cursor: pointer"
                    ></i>
                    <i
                      class="bi bi-back"
                      (mousedown)="onLevelDuplicateClick(i, level.id)"
                      *ngIf="level.type === annotJSONType.SEGMENT"
                      style="margin-left: 3px; cursor: pointer"
                    ></i>
                  </td>
                </tr>
                <tr>
                  <td
                    colspan="3"
                    (click)="onLevelAddClick()"
                    class="level-add-row"
                  >
                    <i class="bi bi-plus-lg"></i>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </li>

        <!--
        infoDropdown
        -->
        <li
          class="nav-item dropdown"
          *ngIf="
            appStorage.loggedIn &&
            appStorage.audioLoaded &&
            navbarServ.filesize !== undefined
          "
          ngbDropdown
          [container]="'body'"
          display="dynamic"
          placement="bottom-end"
        >
          <a ngbDropdownToggle type="button" class="nav-link">
            <i class="bi bi-info-circle-fill navbar-icon"></i>
          </a>
          <div
            ngbDropdownMenu
            class="dropdown-menu dropdown dropdown-primary dropdown-menu-right"
            role="menu"
          >
            <table class="table table-sm table-striped info-menu">
              <tr
                *ngIf="
                  appStorage.useMode === 'online' ||
                  appStorage.useMode === 'demo'
                "
              >
                <td>
                  <span>{{ 'general.project' | transloco }}:</span>
                </td>
                <td>
                  <span>{{
                    appStorage.onlineSession?.currentProject?.name
                  }}</span>
                </td>
              </tr>
              <tr
                *ngIf="
                  appStorage.useMode === 'online' ||
                  appStorage.useMode === 'demo'
                "
              >
                <td>
                  <span>{{ 'general.free jobs' | transloco }}:</span>
                </td>
                <td>
                  <span>{{ appStorage.onlineSession?.currentProject?.statistics?.freeTasks }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span>{{ 'general.name' | transloco }}:</span>
                </td>
                <td>
                  <span>{{ navbarServ.ressource!.info!.fullname }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span>{{ 'general.duration' | transloco }}:</span>
                </td>
                <td>
                  <span
                    >{{
                      navbarServ.ressource!.info!.duration.unix
                        | timespan
                          : {
                              showHour: true
                            }
                    }}
                    (H:m:s)</span
                  >
                </td>
              </tr>
              <tr>
                <td>
                  <span>{{ 'general.sampleRate' | transloco }}:</span>
                </td>
                <td>
                  <span>{{ navbarServ.ressource!.info!.sampleRate }}</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span>{{ 'general.bitspersecond' | transloco }}:</span>
                </td>
                <td>
                  <span>{{ navbarServ.ressource!.info!.bitrate }} Bit/s</span>
                </td>
              </tr>
              <tr>
                <td>
                  <span>{{ 'general.filesize' | transloco }}:</span>
                </td>
                <td>
                  <span
                    >{{ navbarServ.filesize.size }}
                    {{ navbarServ.filesize.label }}</span
                  >
                </td>
              </tr>
              <tr
                *ngIf="
                  appStorage.useMode === 'online' ||
                  appStorage.useMode === 'demo'
                "
              >
                <td>
                  <span>{{ 'general.id' | transloco }}:</span>
                </td>
                <td>
                  <span>{{ appStorage.currentTask?.id }}</span>
                </td>
              </tr>
            </table>
          </div>
        </li>
        <li
          *ngIf="
            appStorage.loggedIn &&
            appStorage.audioLoaded &&
            navbarServ.showExport
          "
          class="nav-item"
        >
          <a (mouseup)="openToolsModal()" class="nav-link">
            <i class="bi bi-tools navbar-icon"></i>
            <span class="d-md-none d-lg-inline">
              {{ 'general.tools' | transloco }}</span
            >
          </a>
        </li>
        <li
          *ngIf="
            appStorage.loggedIn &&
            appStorage.audioLoaded &&
            navbarServ.showExport
          "
          class="nav-item"
        >
          <a (mouseup)="openExportModal()" class="nav-link">
            <i class="bi bi-download navbar-icon"></i>
            <span class="d-md-none d-lg-inline">
              {{ 'general.export' | transloco }}</span
            >
          </a>
        </li>

        <!-- options -->
        <li
          class="nav-item dropdown"
          *ngIf="transcrServ !== undefined"
          [ngStyle]="{
            display: !(appStorage.audioLoaded && appStorage.loggedIn)
              ? 'none'
              : 'inherit'
          }"
          ngbDropdown
          [container]="'body'"
          display="dynamic"
          placement="bottom-end"
        >
          <a ngbDropdownToggle type="button" class="nav-link">
            <i class="bi bi-gear-wide-connected"></i>
          </a>
          <div
            ngbDropdownMenu
            class="dropdown-menu dropdown dropdown-primary dropdown-menu-right options-menu"
            role="menu"
            (click)="$event.stopPropagation()"
          >
            <table class="table">
              <tr>
                <td>
                  <label class="form-check-label" for="easymode"
                    >{{ 'settings.easy mode' | transloco }}:</label
                  >
                </td>
                <td class="align-middle">
                  <div
                    class="form-check form-switch form-check-reverse form-check-inline"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      (click)="toggleSettings('easymode')"
                      [checked]="appStorage.easymode"
                      id="easymode"
                    />
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <label for="playonhover"
                    >{{ 'settings.play on hover' | transloco }}:</label
                  >
                </td>
                <td>
                  <div
                    class="form-check form-switch form-check-reverse form-check-inline"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      (click)="toggleSettings('playonhover')"
                      [checked]="appStorage.playonhover"
                      id="playonhover"
                    />
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <label for="followplaycursor"
                    >{{ 'settings.follow playcursor' | transloco }}:</label
                  >
                </td>
                <td>
                  <div
                    class="form-check form-switch form-check-reverse form-check-inline"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      (click)="toggleSettings('followplaycursor')"
                      [checked]="appStorage.followPlayCursor"
                      id="followplaycursor"
                    />
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <label for="logging"
                    >{{ 'settings.logging' | transloco }}:</label
                  >
                </td>
                <td>
                  <div
                    class="form-check form-switch form-check-reverse form-check-inline"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      (click)="toggleSettings('logging')"
                      [checked]="appStorage.logging"
                      [disabled]="
                        appStorage.useMode === 'online' ||
                        appStorage.useMode === 'demo'
                      "
                      id="logging"
                    />
                  </div>
                </td>
              </tr>
              <tr>
                <td>
                  <label for="showLoupe"
                    >{{ 'settings.show loupe' | transloco }}:</label
                  >
                </td>
                <td>
                  <div
                    class="form-check form-switch form-check-reverse form-check-inline"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      role="switch"
                      (click)="toggleSettings('showLoupe')"
                      [checked]="appStorage.showLoupe"
                      id="showLoupe"
                    />
                  </div>
                </td>
              </tr>
            </table>
            <ng-container *ngIf="appStorage.interface === '2D-Editor'">
              <hr style="border: 1px solid lightgray" />
              <br />
              <label style="font-size: 1.2em"
                >{{ 'settings.seconds per line' | transloco }}:</label
              >
              <br />
              <div
                class="btn-group w-100"
                role="group"
                aria-label="Basic example"
              >
                <button
                  [ngClass]="{
                    'btn-primary': secondsPerLine === 5,
                    'btn-secondary': secondsPerLine !== 5
                  }"
                  type="button"
                  class="btn btn-sm"
                  (click)="changeSecondsPerLine(5)"
                  name="secondsPerLine"
                >
                  5
                </button>
                <button
                  [ngClass]="{
                    'btn-primary': secondsPerLine === 10,
                    'btn-secondary': secondsPerLine !== 10
                  }"
                  type="button"
                  class="btn btn-sm"
                  (click)="changeSecondsPerLine(10)"
                  name="secondsPerLine"
                >
                  10
                </button>
                <button
                  [ngClass]="{
                    'btn-primary': secondsPerLine === 15,
                    'btn-secondary': secondsPerLine !== 15
                  }"
                  type="button"
                  class="btn btn-sm"
                  (click)="changeSecondsPerLine(15)"
                  name="secondsPerLine"
                >
                  15
                </button>
                <button
                  [ngClass]="{
                    'btn-primary': secondsPerLine === 20,
                    'btn-secondary': secondsPerLine !== 20
                  }"
                  type="button"
                  class="btn btn-sm"
                  (click)="changeSecondsPerLine(20)"
                  name="secondsPerLine"
                >
                  20
                </button>
                <button
                  [ngClass]="{
                    'btn-primary': secondsPerLine === 60,
                    'btn-secondary': secondsPerLine !== 60
                  }"
                  type="button"
                  class="btn btn-sm"
                  (click)="changeSecondsPerLine(60)"
                  name="secondsPerLine"
                >
                  60
                </button>
              </div>
            </ng-container>
          </div>
        </li>

        <!-- profile -->
        <li
          class="nav-item dropdown"
          *ngIf="
            appStorage.loggedIn &&
            (appStorage.useMode === 'online' || appStorage.useMode === 'demo')
          "
          ngbDropdown
          [container]="'body'"
          display="dynamic"
          placement="bottom-end"
        >
          <a ngbDropdownToggle type="button" class="nav-link">
            <i class="bi bi-person-circle"></i>
          </a>
          <div
            ngbDropdownMenu
            class="dropdown-menu dropdown dropdown-primary dropdown-menu-right"
            role="menu"
          >
            <a class="dropdown-item">
              <i class="bi bi-person-circle"></i>
              Account
            </a>
            <a class="dropdown-item" (click)="backToProjectsList()">
              <i class="bi bi-arrow-left"></i>
              Back to the list of projects
            </a>
            <a class="dropdown-item" (click)="logout()">
              <i class="bi bi-door-open-fill"></i>
              Logout
            </a>
          </div>
        </li>

        <!--
        Feedback
        -->
        <li
          *ngIf="
            settService.appSettings !== undefined &&
            settService.appSettings.octra.bugreport !== undefined &&
            settService.appSettings.octra.bugreport.enabled
          "
          class="nav-item"
        >
          <a (mouseup)="openBugReport()" class="nav-link">
            <i
              class="bi bi-question-circle-fill navbar-icon"
              style="color: #fcffba"
              [ngStyle]="{
                color: errorsFound ? 'red' : '#fcffba'
              }"
            >
            </i>
            <ng-container *ngIf="!appStorage.loggedIn">
              {{ 'general.feedback' | transloco }}
            </ng-container>
          </a>
        </li>

        <!-- languageDropdown -->
        <li
          class="nav-item dropdown"
          ngbDropdown
          [container]="'body'"
          display="dynamic"
          placement="bottom-end"
        >
          <a ngbDropdownToggle type="button" class="nav-link dropdown-toggle">
            {{ langService.getActiveLang() | uppercase }}
            <span class="caret"></span>
          </a>
          <div
            ngbDropdownMenu
            class="dropdown-menu dropdown dropdown-primary dropdown-menu-right"
            role="menu"
          >
            <ng-container *ngIf="settService.appSettings !== undefined">
              <a
                (click)="changeLanguage(item)"
                *ngFor="let item of settService.appSettings.octra.languages"
                class="dropdown-item"
              >
                {{ item | uppercase }}</a
              >
            </ng-container>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>
